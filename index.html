<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¨Ø¶ Ø§Ù„Ø·Ù‚Ø³ | Ù…Ù†ØµØ© Ø·Ù‚Ø³ Ù…ØªÙ‚Ø¯Ù…Ø©</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap"
        rel="stylesheet">

    <style>
        :root {
            color-scheme: light;
            --primary: #1f2a44;
            --secondary: #1c6dd0;
            --accent: #f5b50a;
            --mint: #1cc5dc;
            --text-dark: #1d2433;
            --text-light: #5b6575;
            --bg: #edf2f7;
            --card: #ffffff;
            --border: #dfe4ea;
            --shadow: 0 18px 40px rgba(23, 32, 47, 0.12);
            --shadow-soft: 0 10px 25px rgba(23, 32, 47, 0.08);
            --radius: 20px;
            --transition: 0.3s ease;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 24px;
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(140deg, #f4f7fb 0%, #e7f0ff 35%, #f4f2ff 100%);
            color: var(--text-dark);
        }

        a {
            color: inherit;
            text-decoration: none;
        }

        .skip-link {
            position: absolute;
            right: 16px;
            top: -50px;
            padding: 8px 16px;
            background: var(--primary);
            color: #fff;
            border-radius: 10px;
            transition: var(--transition);
            z-index: 5;
        }

        .skip-link:focus {
            top: 16px;
        }

        .app {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            gap: 24px;
        }

        header {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            align-items: center;
            justify-content: space-between;
            background: var(--card);
            padding: 24px 28px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 800;
            font-size: 24px;
            color: var(--primary);
        }

        .brand span {
            display: inline-flex;
            width: 12px;
            height: 32px;
            background: var(--accent);
            border-radius: 6px;
        }

        .header-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
        }

        .pill {
            background: rgba(28, 109, 208, 0.12);
            color: #1c56a8;
            padding: 6px 14px;
            border-radius: 999px;
            font-weight: 700;
            font-size: 13px;
        }

        .toggle {
            display: flex;
            align-items: center;
            background: #f5f7fb;
            border-radius: 999px;
            padding: 6px;
            gap: 6px;
        }

        .toggle button {
            border: none;
            background: transparent;
            padding: 6px 14px;
            font-weight: 700;
            border-radius: 999px;
            cursor: pointer;
            color: var(--text-light);
            transition: var(--transition);
        }

        .toggle button.active {
            background: var(--primary);
            color: #fff;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            gap: 24px;
        }

        .hero {
            background: linear-gradient(140deg, #1f2a44 0%, #1c6dd0 60%, #1cc5dc 100%);
            color: #fff;
            border-radius: var(--radius);
            padding: 32px;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .hero::after {
            content: '';
            position: absolute;
            width: 240px;
            height: 240px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.14);
            top: -60px;
            left: -60px;
        }

        .hero-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 16px;
            position: relative;
            z-index: 1;
        }

        .hero h1 {
            margin: 0 0 8px;
            font-size: 28px;
        }

        .hero p {
            margin: 4px 0;
            color: rgba(255, 255, 255, 0.8);
        }

        .temp {
            font-size: 64px;
            font-weight: 800;
            margin: 16px 0;
        }

        .hero-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin-top: 24px;
            position: relative;
            z-index: 1;
        }

        .detail-card {
            background: rgba(255, 255, 255, 0.16);
            border-radius: 16px;
            padding: 14px 16px;
            backdrop-filter: blur(6px);
        }

        .detail-card span {
            display: block;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
        }

        .detail-card strong {
            font-size: 18px;
        }

        .search-panel {
            background: var(--card);
            padding: 24px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-soft);
        }

        .search-panel h2 {
            margin-top: 0;
            font-size: 20px;
        }

        .search-panel form {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .search-panel input {
            flex: 1 1 200px;
            padding: 12px 14px;
            border-radius: 12px;
            border: 1px solid var(--border);
            font-size: 15px;
        }

        .btn {
            border: none;
            padding: 12px 18px;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Tajawal', sans-serif;
        }

        .btn-primary {
            background: var(--secondary);
            color: #fff;
        }

        .btn-primary:hover {
            filter: brightness(1.05);
        }

        .btn-ghost {
            background: #f4f6fb;
            color: var(--text-dark);
            border: 1px solid var(--border);
        }

        .btn-ghost:hover {
            background: #e9eef7;
        }

        .insights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .insight-card {
            background: var(--card);
            padding: 16px;
            border-radius: 16px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-soft);
        }

        .insight-card span {
            color: var(--text-light);
            font-size: 13px;
        }

        .insight-card strong {
            display: block;
            margin-top: 8px;
            font-size: 20px;
        }

        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
        }

        .forecast-card {
            background: var(--card);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .forecast-card strong {
            display: block;
            margin: 6px 0;
        }

        .hourly-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: 12px;
        }

        .hourly-card {
            background: #f7f9fc;
            border-radius: 14px;
            padding: 12px;
            text-align: center;
            border: 1px solid #e6ecf3;
        }

        .status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 14px;
        }

        .section-title {
            margin: 0 0 16px;
            font-size: 20px;
        }

        .footer {
            text-align: center;
            color: var(--text-light);
            font-size: 13px;
            margin: 20px 0;
        }

        @media (max-width: 900px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 700px) {
            header {
                padding: 18px;
            }

            .hero {
                padding: 24px;
            }

            .temp {
                font-size: 52px;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                transition: none !important;
            }
        }
    </style>
</head>

<body>
    <a class="skip-link" href="#weatherApp">ØªØ®Ø·ÙŠ Ø¥Ù„Ù‰ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø·Ù‚Ø³</a>
    <div class="app" id="weatherApp">
        <header>
            <div class="brand"><span></span> Ù†Ø¨Ø¶ Ø§Ù„Ø·Ù‚Ø³</div>
            <div class="header-actions">
                <span class="pill" id="lastUpdated">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                <div class="toggle" role="group" aria-label="ØªØ¨Ø¯ÙŠÙ„ ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù‚ÙŠØ§Ø³">
                    <button type="button" class="active" data-unit="c">Ù…Ø¦ÙˆÙŠØ©</button>
                    <button type="button" data-unit="f">ÙÙ‡Ø±Ù†Ù‡Ø§ÙŠØª</button>
                </div>
            </div>
        </header>

        <section class="main-grid">
            <article class="hero" aria-live="polite">
                <div class="hero-header">
                    <div>
                        <h1 id="locationName">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©...</h1>
                        <p id="localTime">--</p>
                        <div class="status" id="weatherStatus">--</div>
                    </div>
                    <div id="weatherIcon" aria-hidden="true" style="font-size: 56px;">â›…</div>
                </div>
                <div class="temp" id="tempNow">--Â°</div>
                <p id="feelsLike">Ø§Ù„Ø´Ø¹ÙˆØ± Ø§Ù„ÙØ¹Ù„ÙŠ: --</p>
                <div class="hero-details" id="heroDetails"></div>
            </article>

            <aside class="search-panel">
                <h2>Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆÙ‚Ø¹Ùƒ Ø¨Ø¯Ù‚Ø©</h2>
                <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£Ø¯Ù‚ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª.</p>
                <form id="searchForm">
                    <input type="text" id="cityInput" name="city" placeholder="Ù…Ø«Ø§Ù„: Ø¨ØºØ¯Ø§Ø¯ØŒ Ø¬Ø¯Ø©ØŒ Ø¯Ø¨ÙŠ" required>
                    <button class="btn btn-primary" type="submit">Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù‚Ø³</button>
                    <button class="btn btn-ghost" type="button" id="geoButton">Ø§Ø³ØªØ®Ø¯Ù… Ù…ÙˆÙ‚Ø¹ÙŠ</button>
                </form>
                <div class="insights" id="insights"></div>
            </aside>
        </section>

        <section>
            <h2 class="section-title">Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø³Ø§Ø¹ÙŠØ© (12 Ø³Ø§Ø¹Ø©)</h2>
            <div class="hourly-grid" id="hourlyForecast"></div>
        </section>

        <section>
            <h2 class="section-title">ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</h2>
            <div class="forecast-grid" id="dailyForecast"></div>
        </section>

        <div class="footer">
            ØªØ¹ØªÙ…Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ù‰ Ù…Ù†ØµØ© Open-MeteoØŒ ÙˆÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©.
        </div>
    </div>

    <script>
        const weatherCodeMap = {
            0: { text: 'Ø³Ù…Ø§Ø¡ ØµØ§ÙÙŠØ©', icon: 'â˜€ï¸' },
            1: { text: 'ØºØ§Ø¦Ù… Ø¬Ø²Ø¦ÙŠØ§Ù‹', icon: 'ğŸŒ¤ï¸' },
            2: { text: 'ØºØ§Ø¦Ù…', icon: 'â›…' },
            3: { text: 'ØºØ§Ø¦Ù… ÙƒÙ„ÙŠØ§Ù‹', icon: 'â˜ï¸' },
            45: { text: 'Ø¶Ø¨Ø§Ø¨', icon: 'ğŸŒ«ï¸' },
            48: { text: 'Ø¶Ø¨Ø§Ø¨ ÙƒØ«ÙŠÙ', icon: 'ğŸŒ«ï¸' },
            51: { text: 'Ø±Ø°Ø§Ø° Ø®ÙÙŠÙ', icon: 'ğŸŒ¦ï¸' },
            53: { text: 'Ø±Ø°Ø§Ø° Ù…ØªÙˆØ³Ø·', icon: 'ğŸŒ¦ï¸' },
            55: { text: 'Ø±Ø°Ø§Ø° ÙƒØ«ÙŠÙ', icon: 'ğŸŒ§ï¸' },
            61: { text: 'Ø£Ù…Ø·Ø§Ø± Ø®ÙÙŠÙØ©', icon: 'ğŸŒ¦ï¸' },
            63: { text: 'Ø£Ù…Ø·Ø§Ø± Ù…ØªÙˆØ³Ø·Ø©', icon: 'ğŸŒ§ï¸' },
            65: { text: 'Ø£Ù…Ø·Ø§Ø± ØºØ²ÙŠØ±Ø©', icon: 'ğŸŒ§ï¸' },
            71: { text: 'Ø«Ù„ÙˆØ¬ Ø®ÙÙŠÙØ©', icon: 'ğŸŒ¨ï¸' },
            73: { text: 'Ø«Ù„ÙˆØ¬ Ù…ØªÙˆØ³Ø·Ø©', icon: 'â„ï¸' },
            75: { text: 'Ø«Ù„ÙˆØ¬ ÙƒØ«ÙŠÙØ©', icon: 'â„ï¸' },
            80: { text: 'Ø²Ø®Ø§Øª Ø®ÙÙŠÙØ©', icon: 'ğŸŒ¦ï¸' },
            81: { text: 'Ø²Ø®Ø§Øª Ù…ØªÙˆØ³Ø·Ø©', icon: 'ğŸŒ§ï¸' },
            82: { text: 'Ø²Ø®Ø§Øª Ù‚ÙˆÙŠØ©', icon: 'â›ˆï¸' },
            95: { text: 'Ø¹ÙˆØ§ØµÙ Ø±Ø¹Ø¯ÙŠØ©', icon: 'â›ˆï¸' },
            96: { text: 'Ø¹ÙˆØ§ØµÙ Ù…Ø¹ Ø¨Ø±Ø¯', icon: 'â›ˆï¸' },
            99: { text: 'Ø¹ÙˆØ§ØµÙ Ø´Ø¯ÙŠØ¯Ø©', icon: 'â›ˆï¸' }
        };

        const state = {
            unit: 'c',
            location: null,
            weather: null
        };

        const elements = {
            locationName: document.getElementById('locationName'),
            localTime: document.getElementById('localTime'),
            weatherStatus: document.getElementById('weatherStatus'),
            tempNow: document.getElementById('tempNow'),
            feelsLike: document.getElementById('feelsLike'),
            heroDetails: document.getElementById('heroDetails'),
            insights: document.getElementById('insights'),
            hourlyForecast: document.getElementById('hourlyForecast'),
            dailyForecast: document.getElementById('dailyForecast'),
            lastUpdated: document.getElementById('lastUpdated'),
            weatherIcon: document.getElementById('weatherIcon')
        };

        const toFahrenheit = (celsius) => (celsius * 9) / 5 + 32;

        const formatTemp = (value) => {
            if (value === null || value === undefined || Number.isNaN(value)) return '--';
            const temp = state.unit === 'c' ? value : toFahrenheit(value);
            return `${Math.round(temp)}Â°`;
        };

        const formatWind = (value) => `${Math.round(value)} ÙƒÙ…/Ø³`;

        const formatTime = (timeString, options = {}) => {
            const date = new Date(timeString);
            return new Intl.DateTimeFormat('ar-IQ', {
                hour: 'numeric',
                minute: 'numeric',
                ...options
            }).format(date);
        };

        const formatDay = (timeString) => {
            const date = new Date(timeString);
            return new Intl.DateTimeFormat('ar-IQ', {
                weekday: 'long'
            }).format(date);
        };

        const getWeatherInfo = (code) => weatherCodeMap[code] || { text: 'Ø£Ø¬ÙˆØ§Ø¡ Ù…ØªØºÙŠØ±Ø©', icon: 'ğŸŒ¥ï¸' };

        const updateHeroDetails = (current) => {
            const items = [
                { label: 'Ø§Ù„Ø±Ø·ÙˆØ¨Ø©', value: `${current.relative_humidity_2m}%` },
                { label: 'Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­', value: formatWind(current.wind_speed_10m) },
                { label: 'Ù…Ø¤Ø´Ø± Ø§Ù„Ø£Ø´Ø¹Ø©', value: current.uv_index?.toFixed(1) ?? '--' },
                { label: 'Ø§Ù„Ø¶ØºØ·', value: `${Math.round(current.pressure_msl)} hPa` },
                { label: 'Ø§Ù„Ø±Ø¤ÙŠØ©', value: `${(current.visibility / 1000).toFixed(1)} ÙƒÙ…` },
                { label: 'ØºØ·Ø§Ø¡ Ø§Ù„Ø³Ø­Ø¨', value: `${current.cloud_cover}%` }
            ];

            elements.heroDetails.innerHTML = items
                .map(
                    (item) => `
                    <div class="detail-card">
                        <span>${item.label}</span>
                        <strong>${item.value}</strong>
                    </div>
                `
                )
                .join('');
        };

        const updateInsights = (daily) => {
            const todayIndex = 0;
            const sunrise = daily.sunrise[todayIndex];
            const sunset = daily.sunset[todayIndex];
            const items = [
                { label: 'Ø´Ø±ÙˆÙ‚ Ø§Ù„Ø´Ù…Ø³', value: formatTime(sunrise) },
                { label: 'ØºØ±ÙˆØ¨ Ø§Ù„Ø´Ù…Ø³', value: formatTime(sunset) },
                { label: 'Ø£Ø¹Ù„Ù‰ Ø¯Ø±Ø¬Ø© Ø§Ù„ÙŠÙˆÙ…', value: formatTemp(daily.temperature_2m_max[todayIndex]) },
                { label: 'Ø£Ù‚Ù„ Ø¯Ø±Ø¬Ø© Ø§Ù„ÙŠÙˆÙ…', value: formatTemp(daily.temperature_2m_min[todayIndex]) },
                { label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù…Ø·Ø§Ø±', value: `${daily.precipitation_sum[todayIndex]} Ù…Ù„Ù…` },
                { label: 'Ø£Ø¹Ù„Ù‰ Ù…Ø¤Ø´Ø± UV', value: daily.uv_index_max[todayIndex].toFixed(1) }
            ];

            elements.insights.innerHTML = items
                .map(
                    (item) => `
                    <div class="insight-card">
                        <span>${item.label}</span>
                        <strong>${item.value}</strong>
                    </div>
                `
                )
                .join('');
        };

        const updateHourly = (hourly) => {
            const now = new Date();
            const items = hourly.time
                .map((time, index) => ({
                    time: new Date(time),
                    temperature: hourly.temperature_2m[index],
                    code: hourly.weather_code[index],
                    rain: hourly.precipitation_probability[index],
                    wind: hourly.wind_speed_10m[index]
                }))
                .filter((entry) => entry.time >= now)
                .slice(0, 12);

            elements.hourlyForecast.innerHTML = items
                .map((entry) => {
                    const info = getWeatherInfo(entry.code);
                    return `
                    <div class="hourly-card">
                        <div>${formatTime(entry.time)}</div>
                        <div style="font-size: 24px;">${info.icon}</div>
                        <strong>${formatTemp(entry.temperature)}</strong>
                        <div>Ø±Ø·ÙˆØ¨Ø© Ø§Ù„Ù…Ø·Ø± ${entry.rain}%</div>
                        <div>${formatWind(entry.wind)}</div>
                    </div>
                `;
                })
                .join('');
        };

        const updateDaily = (daily) => {
            const items = daily.time.map((time, index) => {
                const info = getWeatherInfo(daily.weather_code[index]);
                return {
                    day: formatDay(time),
                    icon: info.icon,
                    desc: info.text,
                    max: daily.temperature_2m_max[index],
                    min: daily.temperature_2m_min[index],
                    rain: daily.precipitation_sum[index]
                };
            });

            elements.dailyForecast.innerHTML = items
                .map(
                    (item) => `
                    <div class="forecast-card">
                        <div>${item.day}</div>
                        <div style="font-size: 26px;">${item.icon}</div>
                        <strong>${item.desc}</strong>
                        <div>${formatTemp(item.max)} / ${formatTemp(item.min)}</div>
                        <div>Ø£Ù…Ø·Ø§Ø±: ${item.rain} Ù…Ù„Ù…</div>
                    </div>
                `
                )
                .join('');
        };

        const updateUI = () => {
            if (!state.weather || !state.location) return;
            const { current, daily } = state.weather;
            const info = getWeatherInfo(current.weather_code);
            elements.locationName.textContent = `${state.location.name}ØŒ ${state.location.country}`;
            elements.localTime.textContent = `Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…Ø­Ù„ÙŠ: ${formatTime(state.weather.current.time, { day: 'numeric', month: 'long' })}`;
            elements.weatherStatus.textContent = info.text;
            elements.weatherIcon.textContent = info.icon;
            elements.tempNow.textContent = formatTemp(current.temperature_2m);
            elements.feelsLike.textContent = `Ø§Ù„Ø´Ø¹ÙˆØ± Ø§Ù„ÙØ¹Ù„ÙŠ: ${formatTemp(current.apparent_temperature)}`;

            updateHeroDetails(current);
            updateInsights(daily);
            updateHourly(state.weather.hourly);
            updateDaily(daily);

            elements.lastUpdated.textContent = `Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${formatTime(state.weather.current.time)}`;
        };

        const fetchWeather = async (latitude, longitude) => {
            const url = new URL('https://api.open-meteo.com/v1/forecast');
            url.search = new URLSearchParams({
                latitude,
                longitude,
                current: 'temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,wind_speed_10m,wind_direction_10m,uv_index,cloud_cover,pressure_msl,visibility',
                hourly: 'temperature_2m,precipitation_probability,weather_code,wind_speed_10m',
                daily: 'weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum,sunrise,sunset,uv_index_max',
                timezone: 'auto'
            }).toString();

            const response = await fetch(url);
            if (!response.ok) throw new Error('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³.');
            return response.json();
        };

        const fetchCity = async (name) => {
            const url = new URL('https://geocoding-api.open-meteo.com/v1/search');
            url.search = new URLSearchParams({
                name,
                count: 1,
                language: 'ar',
                format: 'json'
            }).toString();

            const response = await fetch(url);
            if (!response.ok) throw new Error('ØªØ¹Ø°Ø± Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©.');
            return response.json();
        };

        const loadCity = async (cityName) => {
            try {
                elements.locationName.textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...';
                const data = await fetchCity(cityName);
                if (!data.results?.length) {
                    throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.');
                }
                const result = data.results[0];
                state.location = {
                    name: result.name,
                    country: result.country
                };
                state.weather = await fetchWeather(result.latitude, result.longitude);
                updateUI();
            } catch (error) {
                elements.locationName.textContent = 'ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
                elements.weatherStatus.textContent = error.message;
            }
        };

        const loadByGeo = () => {
            if (!navigator.geolocation) {
                elements.weatherStatus.textContent = 'Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹.';
                return;
            }

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const { latitude, longitude } = position.coords;
                    state.location = { name: 'Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ', country: '' };
                    state.weather = await fetchWeather(latitude, longitude);
                    updateUI();
                },
                () => {
                    elements.weatherStatus.textContent = 'ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ.';
                }
            );
        };

        document.querySelectorAll('.toggle button').forEach((button) => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.toggle button').forEach((btn) => btn.classList.remove('active'));
                button.classList.add('active');
                state.unit = button.dataset.unit;
                updateUI();
            });
        });

        document.getElementById('searchForm').addEventListener('submit', (event) => {
            event.preventDefault();
            const city = document.getElementById('cityInput').value.trim();
            if (city) {
                loadCity(city);
            }
        });

        document.getElementById('geoButton').addEventListener('click', () => {
            loadByGeo();
        });

        loadCity('Ø¨ØºØ¯Ø§Ø¯');
    </script>
</body>

</html>
